# Data marts are the final models, and often a join between multiple data sources so we name them by their type: facts (fct) or dimensions (dim)
#Fact tables capture the quantitative essence of business events – sales, clicks, shipments. Dimension tables provide the crucial context – who, what, where, when
version: 2

models:
  - name: fct_sender_rewards
    description: >
      Model with only the auctions where we have a setlement and the solver addresses
      so that we can either pay out the solver or ask for penalty.
    columns:
      - name: auction_id
        description: we should only have one winner per auction, otherwise it means that multiple solvers settled!
        data_tests:
          - unique:
              severity: warn
      - name: capped_reward
        description: either a positive, null or negative reward associated with the auction and the solver
        data_tests: 
          - not_null
  - name: fct_data_per_trade
    description: >
      Data for each trades that can not be derived from onchain information. 
      A trade is an execution of an order. There are partially fillable orders, so one order can be executed in multiple times.
      It is also the name of the trade events that are on-chain.
      network_fee_amount and other amounts are in the token (not WEI)
      TODO Tests: 
       - tx_hash and order_uid unique combo.
       - protocol_fee_amount should not be above 1 percent of buy amount for buy order or sell amount of sell order (in the trades table for amounts, and type of order in the order table)
       - network_fee_amount * network_fee_price should not be below minus 10e12 WEI
       - if there is a partner_fee, there should always be a protocol_fee
       - order_uid, tx_hash, auction_id, block_number, solver, network_fee_amount, network_fee_price not null
       